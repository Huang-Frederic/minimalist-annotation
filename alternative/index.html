<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            background-color: #121212;
            color: #E0E0E0;
            font-family: Arial, sans-serif;
        }
        button {
            background-color: #333;
            color: #FFF;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #555;
        }
        #canvasContainer {
            position: relative;
            width: 90%;
            max-width: 900px; /* Adjust based on your preference */
            height: 80vh;
            margin: auto;
            border: 3px solid #333;
            border-radius: 10px;
            overflow: hidden; /* Ensures nothing spills outside the container */
        }
        canvas {
            display: block;
            width: 100%; /* Fill the container but maintain aspect ratio */
            height: 100%; /* Image will scale based on this */
        }
    </style>
</head>
<body>

<input type="file" id="folderInput" webkitdirectory directory multiple>
<button id="prevButton" class="hidden">Previous</button>
<button id="nextButton" class="hidden">Next</button>
<div id="canvasContainer">
    <canvas id="imageCanvas"></canvas>
</div>

<script>
let imageFiles = [];
let currentIndex = 0;
let annotations = [];
let canvas = document.getElementById('imageCanvas');
let ctx = canvas.getContext('2d');
let currentImage = null;
let margin = 20; // Margin around the image

document.getElementById('folderInput').addEventListener('change', function(event) {
    const files = event.target.files;
    imageFiles = [];
    annotations = [];

    for (const file of files) {
        if (file.type.startsWith('image/')) {
            imageFiles.push(file);
            annotations.push([]);
        }
    }

    if(imageFiles.length > 0) {
        document.getElementById('folderInput').style.display = 'none';
        document.getElementById('prevButton').classList.remove('hidden');
        document.getElementById('nextButton').classList.remove('hidden');
        canvas.classList.remove('hidden');
        showImage();
    } else {
        alert('No images found in the folder.');
    }
});

document.getElementById('nextButton').addEventListener('click', function() {
    if(currentIndex < imageFiles.length - 1) {
        currentIndex++;
        showImage();
    }
});

document.getElementById('prevButton').addEventListener('click', function() {
    if(currentIndex > 0) {
        currentIndex--;
        showImage();
    }
});

canvas.addEventListener('mousemove', function(event) {
    drawImage();
    drawCrosshair(event.offsetX, event.offsetY);
});

function drawImage() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    let maxCanvasWidth = canvas.width - 2 * margin;
    let maxCanvasHeight = canvas.height - 2 * margin;
    let ratio = Math.min(maxCanvasWidth / currentImage.width, maxCanvasHeight / currentImage.height);
    let x = (canvas.width - currentImage.width * ratio) / 2;
    let y = (canvas.height - currentImage.height * ratio) / 2;
    ctx.drawImage(currentImage, x, y, currentImage.width * ratio, currentImage.height * ratio);
}

function drawCrosshair(x, y) {
    ctx.strokeStyle = 'red';
    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x, canvas.height);
    ctx.moveTo(0, y);
    ctx.lineTo(canvas.width, y);
    ctx.stroke();
}

function showImage() {
    if (currentIndex >= 0 && currentIndex < imageFiles.length) {
        const fileReader = new FileReader();
        fileReader.onload = function(e) {
            currentImage = new Image();
            currentImage.onload = () => {
                canvas.width = canvasContainer.clientWidth;
                canvas.height = canvasContainer.clientHeight;
                drawImage();
            };
            currentImage.src = e.target.result;
        };
        fileReader.readAsDataURL(imageFiles[currentIndex]);
    } else {
        alert('Index out of bounds. This should not happen.');
    }
}
</script>

</body>
</html>
