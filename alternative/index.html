<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            background-color: #121212;
            color: #E0E0E0;
            font-family: Arial, sans-serif;
        }

        button {
            background-color: #333;
            color: #FFF;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #555;
        }

        #canvasContainer {
            position: relative;
            width: 90%;
            max-width: 900px;
            height: 80vh;
            margin: auto;
            border: 3px solid #333;
            border-radius: 10px;
            overflow: hidden;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>

    <input type="file" id="folderInput" webkitdirectory directory multiple>
    <button id="prevButton" class="hidden">Previous</button>
    <button id="nextButton" class="hidden">Next</button>
    <div id="canvasContainer">
        <canvas id="imageCanvas"></canvas>
        <canvas id="crosshairCanvas"></canvas>
    </div>

    <script>
        let imageFiles = [];
        let currentIndex = 0;
        let annotations = [];
        let imageCanvas = document.getElementById('imageCanvas');
        let crosshairCanvas = document.getElementById('crosshairCanvas');
        let imageCtx = imageCanvas.getContext('2d');
        let crosshairCtx = crosshairCanvas.getContext('2d');
        let currentImage = null;
        let margin = 20; // Margin around the image

        document.getElementById('folderInput').addEventListener('change', function (event) {
            const files = event.target.files;
            imageFiles = [];
            annotations = [];

            for (const file of files) {
                if (file.type.startsWith('image/')) {
                    imageFiles.push(file);
                    annotations.push([]);
                }
            }

            if (imageFiles.length > 0) {
                document.getElementById('folderInput').style.display = 'none';
                document.getElementById('prevButton').classList.remove('hidden');
                document.getElementById('nextButton').classList.remove('hidden');
                document.getElementById('imageCanvas').classList.remove('hidden');
                document.getElementById('crosshairCanvas').classList.remove('hidden');
                showImage();
            } else {
                alert('No images found in the folder.');
            }
        });

        document.getElementById('nextButton').addEventListener('click', function () {
            if (currentIndex < imageFiles.length - 1) {
                currentIndex++;
                showImage();
            }
        });

        document.getElementById('prevButton').addEventListener('click', function () {
            if (currentIndex > 0) {
                currentIndex--;
                showImage();
            }
        });

        crosshairCanvas.addEventListener('mousemove', function (event) {
            drawCrosshair(event.offsetX, event.offsetY);
        });

        function drawImage() {
            imageCtx.clearRect(0, 0, imageCanvas.width, imageCanvas.height);
            let maxCanvasWidth = imageCanvas.width - 2 * margin;
            let maxCanvasHeight = imageCanvas.height - 2 * margin;
            let ratio = Math.min(maxCanvasWidth / currentImage.width, maxCanvasHeight / currentImage.height);
            let x = (imageCanvas.width - currentImage.width * ratio) / 2;
            let y = (imageCanvas.height - currentImage.height * ratio) / 2;
            imageCtx.drawImage(currentImage, x, y, currentImage.width * ratio, currentImage.height * ratio);
        }

        function drawCrosshair(x, y) {
            crosshairCtx.clearRect(0, 0, crosshairCanvas.width, crosshairCanvas.height);
            crosshairCtx.strokeStyle = 'red';
            crosshairCtx.beginPath();
            crosshairCtx.moveTo(x, 0);
            crosshairCtx.lineTo(x, crosshairCanvas.height);
            crosshairCtx.moveTo(0, y);
            crosshairCtx.lineTo(crosshairCanvas.width, y);
            crosshairCtx.stroke();
        }

        function showImage() {
            if (currentIndex >= 0 && currentIndex < imageFiles.length) {
                const fileReader = new FileReader();
                fileReader.onload = function (e) {
                    currentImage = new Image();
                    currentImage.onload = () => {
                        imageCanvas.width = crosshairCanvas.width = canvasContainer.clientWidth;
                        imageCanvas.height = crosshairCanvas.height = canvasContainer.clientHeight;
                        drawImage();
                    };
                    currentImage.src = e.target.result;
                };
                fileReader.readAsDataURL(imageFiles[currentIndex]);
            } else {
                alert('Index out of bounds. This should not happen.');
            }
        }
    </script>

</body>

</html>